"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _stringify=require("./../npm/babel-runtime/core-js/json/stringify.js"),_stringify2=_interopRequireDefault(_stringify),_getPrototypeOf=require("./../npm/babel-runtime/core-js/object/get-prototype-of.js"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("./../npm/babel-runtime/helpers/classCallCheck.js"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("./../npm/babel-runtime/helpers/createClass.js"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("./../npm/babel-runtime/helpers/possibleConstructorReturn.js"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("./../npm/babel-runtime/helpers/inherits.js"),_inherits3=_interopRequireDefault(_inherits2),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_jquery=require("./../npm/jquery/dist/jquery.js"),_jquery2=_interopRequireDefault(_jquery),_urls=require("./../services/urls.js"),_urls2=_interopRequireDefault(_urls),_loading=require("./../services/loading.js"),_loading2=_interopRequireDefault(_loading),_wepyComToast=require("./../npm/wepy-com-toast/toast.js"),_wepyComToast2=_interopRequireDefault(_wepyComToast),_request=require("./../services/request.js"),_request2=_interopRequireDefault(_request),_is=require("./../services/is.js"),_is2=_interopRequireDefault(_is),_global=require("./../services/global.js"),_global2=_interopRequireDefault(_global),Booking=function(e){function t(){for(var e,a,r,o,l=arguments,u=arguments.length,n=Array(u),s=0;s<u;s++)n[s]=arguments[s];return(0,_classCallCheck3.default)(this,t),a=r=(0,_possibleConstructorReturn3.default)(this,(e=t.__proto__||(0,_getPrototypeOf2.default)(t)).call.apply(e,[this].concat(n))),r.config={navigationBarTitleText:"线上预约"},r.components={toast:_wepyComToast2.default},r.data={userInfo:null,placeData:null,maxNumber:null,minNumber:null,formData:{place:"",phone:"",meals:[],number:0}},r.computed={hasMeal:function(){return!_is2.default.empty(r.formData.meals)},mealText:function(){return r.formData.meals[0]&&r.formData.meals[0].amount?r.formData.meals[0].name:null},mealamount:function(){return r.formData.meals[0]&&r.formData.meals[0].amount?r.formData.meals[0].amount:null}},r.methods={toMealList:function(e){_global2.default.meals=r.formData.meals,_wepy2.default.navigateTo({url:"/pages/booking-meal"})},doSubmit:function(e){return _is2.default.empty(r.formData.place)?void r.$invoke("toast","show",{title:"请选择游戏地点"}):_is2.default.empty(r.formData.phone)?void r.$invoke("toast","show",{title:"请填写联系电话"}):7!==(r.formData.phone+"").length&&8!==(r.formData.phone+"").length&&11!==(r.formData.phone+"").length?void r.$invoke("toast","show",{title:"请填写正确联系电话"}):(_loading2.default.show("预约中"),void _request2.default.post(_urls2.default.bookingAdd,{place:r.placeData[r.formData.place].id,phone:r.formData.phone,number:r.formData.number,meals:(0,_stringify2.default)(r.formData.meals)}).then(function(e){_wepy2.default.showToast({title:e.msg,icon:"success",duration:2e3}),r.formData={place:null,meals:[],phone:null,number:r.minNumber},r.$apply(),setTimeout(function(){_wepy2.default.reLaunch({url:"/pages/home"})},2e3)}).finally(function(){_loading2.default.hide()}))},setNumber:function(e){r.formData.number=parseInt(e.detail.value,10)},setPlace:function(e){r.formData.place=parseInt(e.detail.value,10)},setPhone:function(e){r.formData.phone=e.detail.value},updateParams:function(){_request2.default.get(_urls2.default.bookingParams).then(function(e){var t=e.result;r.placeData=t.placeList,r.maxNumber=t.maxNumber,r.minNumber=t.minNumber,r.formData.number=t.minNumber,r.formData.meals=t.meals,_is2.default.empty(r.formData.meals)||r.formData.meals.forEach(function(e){e.amount=0}),r.$apply(),_loading2.default.hide()})}},r.events={"update-meal":function(){console.log("update meal",l)}},o=a,(0,_possibleConstructorReturn3.default)(r,o)}return(0,_inherits3.default)(t,e),(0,_createClass3.default)(t,[{key:"onShow",value:function(){_is2.default.empty(_global2.default.meals)||(this.formData.meals=_jquery2.default.extend(!0,[],_global2.default.meals)||[])}},{key:"onLoad",value:function(){var e=this;console.log("rank on load"),_loading2.default.show(),_global2.default.meals=[],_request2.default.getUserInfo().then(function(t){e.userInfo=t,e.methods.updateParams()})}}]),t}(_wepy2.default.page);Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(Booking,"pages/booking"));