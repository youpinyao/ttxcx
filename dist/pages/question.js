"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _stringify=require("./../npm/babel-runtime/core-js/json/stringify.js"),_stringify2=_interopRequireDefault(_stringify),_getPrototypeOf=require("./../npm/babel-runtime/core-js/object/get-prototype-of.js"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("./../npm/babel-runtime/helpers/classCallCheck.js"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("./../npm/babel-runtime/helpers/createClass.js"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("./../npm/babel-runtime/helpers/possibleConstructorReturn.js"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("./../npm/babel-runtime/helpers/inherits.js"),_inherits3=_interopRequireDefault(_inherits2),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_question=require("./../services/question.js"),_question2=_interopRequireDefault(_question),_loading=require("./../services/loading.js"),_loading2=_interopRequireDefault(_loading),_util=require("./../services/util.js"),_util2=_interopRequireDefault(_util),_is=require("./../services/is.js"),_is2=_interopRequireDefault(_is),_wepyComToast=require("./../npm/wepy-com-toast/toast.js"),_wepyComToast2=_interopRequireDefault(_wepyComToast),Question=function(e){function t(){var e,n,i,u;(0,_classCallCheck3.default)(this,t);for(var r=arguments.length,o=Array(r),s=0;s<r;s++)o[s]=arguments[s];return n=i=(0,_possibleConstructorReturn3.default)(this,(e=t.__proto__||(0,_getPrototypeOf2.default)(t)).call.apply(e,[this].concat(o))),i.config={navigationBarTitleText:"答题时间"},i.components={toast:_wepyComToast2.default},i.data={index:-1,list:[],hideTip:!1,isEnd:!1,endData:null,currentQuestion:null,currentAnswer:null},i.computed={beforeTime:function(){if(_is2.default.null(i.endData))return"";var e=_util2.default.renderScore(i.endData.before),t="";return e.hour&&(t+=e.hour+"时"),e.minute&&(t+=e.minute+"分"),e.second&&(t+=e.second+"秒"),t},afterTime:function(){if(_is2.default.null(i.endData))return"";var e=_util2.default.renderScore(i.endData.after),t="";return e.hour&&(t+=e.hour+"时"),e.minute&&(t+=e.minute+"分"),e.second&&(t+=e.second+"秒"),t},minusTime:function(){if(_is2.default.null(i.endData))return"";var e=_util2.default.renderScore(i.endData.minus),t="";return e.hour&&(t+=e.hour+"时"),e.minute&&(t+=e.minute+"分"),e.second&&(t+=e.second+"秒"),t}},i.methods={toRank:function(e){_wepy2.default.redirectTo({url:"/pages/rank"})},toHome:function(e){_wepy2.default.reLaunch({url:"/pages/home"})},next:function(e){return null===i.currentAnswer?void i.$invoke("toast","show",{title:"请选择答案"}):(i.list[i.index].selectAnswer=i.currentAnswer,i.currentAnswer=null,i.methods.nextQuestion(),!0)},select:function(e){null===i.currentAnswer&&(i.currentAnswer=e,console.log("select",e))},quit:function(e){_loading2.default.show(),_question2.default.quit({id:i.id}).then(function(){_wepy2.default.navigateBack()}).finally(function(){_loading2.default.hide()})},start:function(e){_loading2.default.show(),_question2.default.start({id:i.id}).then(function(e){i.hideTip=!0,i.methods.nextQuestion(!0),i.$apply()}).finally(function(){_loading2.default.hide()})},nextQuestion:function(e){if(i.index>=0&&!i.list[i.index])return void i.methods.questionEnd();i.index++,i.list[i.index]?i.methods.showQuestion(i.list[i.index],e):i.methods.questionEnd()},showQuestion:function(e,t){i.currentQuestion=null,t||i.$apply(),setTimeout(function(){i.currentQuestion=e,i.$apply()},t?0:150)},questionEnd:function(){i.currentQuestion=null,i.methods.uploadQuestion()},uploadQuestion:function(){_loading2.default.show("提交中");var e=(0,_stringify2.default)(i.list.map(function(e){return{id:e.id,selectAnswer:e.selectAnswer,answer:e.answer}}));_question2.default.upload({id:i.id,answers:e}).then(function(e){var t=e.before,n=e.after,u=e.minus;i.endData={before:t,after:n,minus:u},i.isEnd=!0,i.$apply()}).finally(function(){_loading2.default.hide()})}},i.events={},u=n,(0,_possibleConstructorReturn3.default)(i,u)}return(0,_inherits3.default)(t,e),(0,_createClass3.default)(t,[{key:"onShow",value:function(){console.log("question show")}},{key:"onLoad",value:function(e){var t=this;console.log("question meal on load",e.id),this.id=e.id,_question2.default.list({id:this.id}).then(function(e){t.index=-1,t.currentAnswer=null,t.currentQuestion=null,t.endData=null,t.list=e.list})}}]),t}(_wepy2.default.page);Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(Question,"pages/question"));