"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_defer=require("./../services/defer.js"),_defer2=_interopRequireDefault(_defer),_question=require("./../services/question.js"),_question2=_interopRequireDefault(_question),_loading=require("./../services/loading.js"),_loading2=_interopRequireDefault(_loading),_util=require("./../services/util.js"),_util2=_interopRequireDefault(_util),_is=require("./../services/is.js"),_is2=_interopRequireDefault(_is),_wepyComToast=require("./../npm/wepy-com-toast/toast.js"),_wepyComToast2=_interopRequireDefault(_wepyComToast),Question=function(e){function t(){var e,n,i,r;_classCallCheck(this,t);for(var o=arguments.length,u=Array(o),s=0;s<o;s++)u[s]=arguments[s];return n=i=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(u))),i.config={navigationBarTitleText:"答题时间"},i.components={toast:_wepyComToast2.default},i.data={index:-1,list:[],hideTip:!1,isEnd:!1,endData:null,currentQuestion:null,currentAnswer:null},i.computed={beforeTime:function(){if(_is2.default.null(i.endData))return"";var e=_util2.default.renderScore(i.endData.before),t="";return e.hour&&(t+=e.hour+"时"),e.minute&&(t+=e.minute+"分"),e.second&&(t+=e.second+"秒"),t},afterTime:function(){if(_is2.default.null(i.endData))return"";var e=_util2.default.renderScore(i.endData.after),t="";return e.hour&&(t+=e.hour+"时"),e.minute&&(t+=e.minute+"分"),e.second&&(t+=e.second+"秒"),t},minusTime:function(){if(_is2.default.null(i.endData))return"";var e=_util2.default.renderScore(i.endData.minus),t="";return e.hour&&(t+=e.hour+"时"),e.minute&&(t+=e.minute+"分"),e.second&&(t+=e.second+"秒"),t}},i.methods={toRank:function(e){_wepy2.default.redirectTo({url:"/pages/rank"})},toHome:function(e){_wepy2.default.reLaunch({url:"/pages/home"})},next:function(e){return null===i.currentAnswer?void i.$invoke("toast","show",{title:"请选择答案"}):(i.list[i.index].selectAnswer=i.currentAnswer,i.methods.nextQuestion().then(function(){i.currentAnswer=null,i.$apply()}),!0)},select:function(e){null===i.currentAnswer&&(i.currentAnswer=e,console.log("select",e))},quit:function(e){_loading2.default.show(),_question2.default.quit({id:i.id}).then(function(){_wepy2.default.navigateBack(),_loading2.default.hide()},function(){_loading2.default.hide()})},start:function(e){_loading2.default.show(),_question2.default.start({id:i.id}).then(function(e){i.hideTip=!0,i.methods.nextQuestion(!0),i.$apply(),_loading2.default.hide()},function(){_loading2.default.hide()})},nextQuestion:function(e){var t=(0,_defer2.default)();return i.index>=0&&!i.list[i.index]?void i.methods.questionEnd().then(function(){t.resolve()}):(i.index++,i.list[i.index]?(i.methods.showQuestion(i.list[i.index],e),setTimeout(function(){t.resolve()})):(i.index=i.list.length-1,i.methods.questionEnd().then(function(){t.resolve()})),t.promise)},showQuestion:function(e,t){i.currentQuestion=null,t||i.$apply(),setTimeout(function(){i.currentQuestion=e,i.$apply()},t?0:150)},questionEnd:function(){var e=(0,_defer2.default)();return i.methods.uploadQuestion().then(function(){i.currentQuestion=null,i.$apply(),e.resolve()}),e.promise},uploadQuestion:function(){var e=(0,_defer2.default)();_loading2.default.show("提交中");var t=JSON.stringify(i.list.map(function(e){return{id:e.id,selectAnswer:e.selectAnswer,answer:e.answer}}));return _question2.default.upload({id:i.id,answers:t}).then(function(t){var n=t.result,r=n.before,o=n.after,u=n.minus,s=n.rightCount;i.endData={before:r,after:o,minus:u,rightCount:s},i.isEnd=!0,e.resolve(),i.$apply(),_loading2.default.hide()},function(){_loading2.default.hide()}),e.promise}},i.events={},r=n,_possibleConstructorReturn(i,r)}return _inherits(t,e),_createClass(t,[{key:"onShow",value:function(){console.log("question show")}},{key:"onLoad",value:function(e){var t=this;console.log("question meal on load",e.id),this.id=e.id,_question2.default.list({id:this.id}).then(function(e){var n=e.result.list;t.index=-1,t.currentAnswer=null,t.currentQuestion=null,t.endData=null,t.list=n})}}]),t}(_wepy2.default.page);Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(Question,"pages/question"));